# Plan: Add Schedule Page + Time/Court Annotations to Division Draws

## Context
The tournament website (`index.html`) shows division draws but has no schedule visualization. The schedule data exists in `schedules/*.json` (generated by `generate_schedule.py`). We need:
1. A new `schedule.html` page showing a time-slot × court grid for each session
2. Time/court annotations on the existing division draw match cards in `index.html`

## File to modify
- **`generate_website.py`** — the sole file to change (currently 530 lines)
- Outputs: `index.html` (modified) + `schedule.html` (new)
- New input: `schedules/schedule_index.json` + `schedules/*.json`

## Implementation

### 1. Schedule data loader

Add `load_schedule_data()` function that:
- Reads `schedules/schedule_index.json`
- Loads each session file (5 files)
- Returns:
  - `all_sessions`: list of session dicts (with matches) for the schedule page
  - `schedule_lookup`: dict keyed by `(division_code, round_name, match_num)` → `{"time", "court", "date"}` for cross-referencing

**Key mapping for cross-reference:**
| Division format | Schedule `round` value | Example |
|---|---|---|
| elimination | `"Round 1"`, `"Quarter-Final"`, etc. | `("MS C", "Round 1", 10)` |
| round_robin | `"Pool"` | `("XD V", "Pool", 3)` |
| group_playoff groups | `"Group A Pool"` | `("BS U17", "Group A Pool", 3)` |
| group_playoff playoff | `"Playoff Semi-Final"` | `("BS U17", "Playoff Semi-Final", 1)` |

### 2. Feature: Time/court on existing division draws

Thread `schedule_lookup` and `division_code` through the rendering call chain:

- `generate_html(schedule_lookup)` → `render_division_card(data, badge, schedule_lookup)` → format-specific renderers → `render_match_card()` / `render_rr_matches()`

**`render_match_card(match, round_abbrev, div_code, round_name, schedule_lookup)`:**
- Look up `(div_code, round_name, match_num)` in schedule_lookup
- If found, add a small annotation: `<span class="match-schedule">Sat 09:00 Ct 5</span>` inside the match-num bar

**`render_rr_matches(matches, div_code, round_prefix, schedule_lookup)`:**
- Same lookup; add annotation to each RR match card

**`render_bracket(rounds, div_code, schedule_lookup)`:**
- Pass round name and div_code through to render_match_card

**`render_elimination_division(data, schedule_lookup)`:**
- Pass `data["code"]` + schedule_lookup to render_bracket

**`render_roundrobin_division(data, schedule_lookup)`:**
- Pass `data["code"]`, `"Pool"`, schedule_lookup to render_rr_matches

**`render_group_playoff_division(data, schedule_lookup)`:**
- For groups: pass round_prefix = `f"{group_name} Pool"` (e.g., `"Group A Pool"`)
- For playoff bracket: pass round_name = `f"Playoff {rnd_name}"` (e.g., `"Playoff Semi-Final"`)

**CSS for annotations:**
```css
.match-schedule { font-size: 0.65rem; color: var(--accent-dark); font-weight: 600; float: right; }
.rr-match .match-schedule { display: block; text-align: center; font-size: 0.7rem; margin-top: 0.2rem; }
```

### 3. Feature: Schedule page (`schedule.html`)

Add `generate_schedule_html(all_sessions)` that produces a complete HTML file.

**Page structure:**
- Same hero styling as index.html (shared CSS variables)
- Navigation link back to index.html
- Session sub-tabs (Saturday Morning | Saturday Afternoon | Saturday Evening | Sunday Morning | Sunday Afternoon)
- Each tab panel contains a `<table class="schedule-grid">` with:
  - **Columns**: Time | Court 1 | Court 2 | ... | Court N (only courts with matches in that session)
  - **Rows**: One per 30-min time slot
  - **Cells**: Match info (division badge, round, players) with category color-coding
  - **45-min matches**: Use `rowspan="2"` and track blocked cells

**`render_schedule_grid(session_data)`:**
```python
# Compute time slots from session start to end (30-min intervals)
# Compute courts used in this session
# Build grid: {(time_str, court): match_data}
# Build blocked set for 45-min matches (next time slot is blocked)
# Render <table>:
#   <thead>: "Time" + court headers
#   <tbody>: for each time slot row, emit <td> per court (or skip if blocked)
```

**Match cell HTML:**
```html
<td class="sched-cell" rowspan="1|2">
  <div class="sched-div"><span class="badge badge-open">MS C</span> R1 M10</div>
  <div class="sched-p">Jesse Viitanen</div>
  <div class="sched-vs">vs</div>
  <div class="sched-p">Jenni Lahti</div>
</td>
```

Empty cells: `<td class="sched-empty"></td>`

**CSS additions for schedule grid:**
- `.schedule-grid`: `width:100%; border-collapse:collapse; font-size:0.75rem; table-layout:fixed`
- `.schedule-grid th`: sticky top, dark primary background, white text
- `.time-cell`: sticky left, bold, 60px wide
- `.sched-cell`: bordered, white bg, `vertical-align:top`, hover highlight
- `.sched-p`: `font-size:0.7rem; overflow:hidden; text-overflow:ellipsis; white-space:nowrap`
- Wrap table in `overflow-x:auto` container for mobile

**Navigation links:**
- `index.html`: Add link in hero or below tabs → "View Match Schedule"
- `schedule.html`: Add link → "View Game Draws"

### 4. Wire up in `main()`

```python
def main():
    schedule_lookup, all_sessions = load_schedule_data()

    # Generate index.html (with schedule annotations)
    html = generate_html(schedule_lookup)
    with open(OUTPUT_FILE, "w", encoding="utf-8") as f:
        f.write(html)

    # Generate schedule.html
    if all_sessions:
        schedule_html = generate_schedule_html(all_sessions)
        with open(SCHEDULE_OUTPUT, "w", encoding="utf-8") as f:
            f.write(schedule_html)
```

## Verification
```bash
python generate_website.py
```
Then:
1. Open `index.html` — verify time/court annotations on match cards (bracket + RR)
2. Open `schedule.html` — verify grid view with session tabs, court columns, time rows
3. Check: 45-min Elite matches span 2 rows
4. Check: category color badges match (Open=blue, Junior=green, Veterans=orange, Elite=purple)
5. Check: navigation links work between the two pages
6. Check: mobile responsive (horizontal scroll on schedule grid)
